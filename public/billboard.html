<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content=""><meta name="author" content=""><title>Everybody's Google</title><link rel="stylesheet" href="/bootstrap-ui/css/bootstrap.css"><style type="text/css">.meta {
 background-color: #ffd;
 border: 4px solid #dda;
 padding: 8px;
}
.meta h2 {
 color: #000;
 font-style: italic;
}
.result {
 width: 49%;
 float: left;
}
body, html {width:100%; height:100%}
.row { margin-top: 5px; margin-bottom: 15px; }
#footer { border-top: 1px solid #EEE; padding-top: 10px; margin-top: 10px; }
#footer * { font-size: 11px; }
</style></head><body>
<div id="fullscreen" style="background-color:lime;position:absolute;z-index:1000;">Full Screen</div>
<div id="container" style="height:50%;width:50%;"></div>


<script src="/javascript/three/build/Three.js"></script>
<script src="/javascript/three/js/ShaderExtras.js"></script>
<script src="/javascript/three/js/postprocessing/EffectComposer.js"></script>
<script src="/javascript/three/js/postprocessing/RenderPass.js"></script>
<script src="/javascript/three/js/postprocessing/BloomPass.js"></script>
<script src="/javascript/three/js/postprocessing/FilmPass.js"></script>
<script src="/javascript/three/js/postprocessing/DotScreenPass.js"></script>
<script src="/javascript/three/js/postprocessing/TexturePass.js"></script>
<script src="/javascript/three/js/postprocessing/ShaderPass.js"></script>
<script src="/javascript/three/js/postprocessing/MaskPass.js"></script>
<script src="/javascript/three/js/Detector.js"></script>
<script src="/javascript/three/js/Stats.js"></script>
<script src="/THREEx.FullScreen.js"></script>
<script src='THREEx.WindowResize.js'></script>


<script type="text/javascript">

			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();


			//textures are currently 512x512... should we do 1024x1024?
			var searches = [{
				"term": "foo"
				, "results": [[
						{ "textureUrl": "/rendered/2f1c4e96-8aac-83ad-009f-b0b1443a8142-tex.jpg" } //result1img1
						, { "textureUrl": "/rendered/3ad20227-fe24-5d59-b179-b3b6fde0d6c4-tex.jpg" } //result1img2
						, { "textureUrl": "/rendered/3b1dd42e-ff4f-4888-b6ef-d7b7a84df4b7-tex.jpg" } //result1img3
						, { "textureUrl": "/rendered/4acf6ddb-3088-1fb1-5c45-1ecd578a68e7-tex.jpg" } //result1img4
					]
					, [
						{ "textureUrl": "/rendered/7b9899a3-3a92-b68d-72d1-cc1aa56e0253-tex.jpg" } //result2img1
						, { "textureUrl": "/rendered/45afb6d8-6f37-efa2-48e0-2d0469647c65-tex.jpg" } //result2img2
						, { "textureUrl": "/rendered/62d1e32f-64df-adc0-24d6-a38929021d7e-tex.jpg" } //result2img3
						, { "textureUrl": "/rendered/68bd3e22-1965-aeaf-5b06-6b6458831884-tex.jpg" } //result2img4
					]
				]}
			];
				
				
			var curSearchIdx = 0;
			var curSearchResultIdx = 0;
			var numBars = 10;
			var billboard;

			var neighborhoods = [];

			var mesh;

			var fullWidth;
			var fullHeight;
			var halfWidth, halfHeight;

			var container;

			var camera, scene, renderer;

			var mouseX = 0, mouseY = 0;


			var startTime;

			init();


					
	

				function imageMat(url, width, offset) {
					//if (!width) width = 0.5;
					//if (offset === undefined) offset = .25;
					//console.log("offset: " + offset);
					var imgTex = THREE.ImageUtils.loadTexture(
						url
						, THREE.UVMapping
						, function(image) {
							//console.log("loadTex callback:");
							//console.log(image)
							//console.log(imgTex);
					});

					//console.log("imgTex:");
					//console.log(imgTex);

					//imgTex.wrapT = THREE.RepeatWrapping;
					imgTex.repeat.set( width, 1 );
					imgTex.offset.x = offset;
					imgTex.needsUpdate = true;
					imgTex.wrapS = imgTex.wrapT = THREE.RepeatWrapping;
					var imgMat = new THREE.MeshBasicMaterial( { color: 0xdddddd, map: imgTex } );
					imgTex.minFilter = imgTex.magFilter = THREE.LinearFilter;
					return imgMat;
				}
				
				function loadTextures(resultsObj, cb) {
					var texWidth = 1/numBars;
					for (var j=0; j<resultsObj.length; j++) {
						var resultObj = resultsObj[j];
						resultObj.materials = [];
						for (var i=0; i<numBars; i++) {
							resultObj.materials.push(imageMat(resultObj.textureUrl, texWidth, texWidth*(-i - 1)));
						
						}
					}
					cb(resultsObj);
				}
				
				function textureBillboard(resultObj) {
					console.log(resultObj);
					for (var j=0; j<resultObj.length; j++) {
						var res = resultObj[j];
						var mats = res.materials;
						for (var i=0; i<numBars; i++) {
						
						//should be four results

						
							//each result object should have 10 materials;
							//for (var k=0; k<resultObj[j].materials.length; k++) {
							
								var mat = mats[i];
								var face = (j>=2) ? j+2 : j;
								//console.log("material: " + i + "; face:" + face);


								
								(function(_geom, _face, _mat) {
									_geom.materials[_face] = _mat;									
									//console.log("texture offsetX: " + _geom.materials[_face].map.offset.x
										//+ "; needsUpdate: " + _geom.materials[_face].map.needsUpdate);
								})(billboard.children[i].geometry, face, mat);
								
								//materials order: left right top bottom front back
								//billboard.children[i].geometry.materials[face].map = mat.map.clone();
								//console.log(billboard.children[i].geometry.materials[face]);
								//billboard.children[i].geometry.materials[face].map.needsUpdate = true;
	
							//}
						}
					}
				
				}
				
				function buildBillboard() {
					billboard = new THREE.Object3D();


					
					for (var i=0; i<numBars; i++) {
						var materials = [];
						for (var j=0; j<6; j++) { materials.push(
							new THREE.MeshPhongMaterial( { ambient: 0x555555, color: 0x555555, specular: 0xffffff, shininess: 50, shading: THREE.SmoothShading }  )
						); }
						var geometry = new THREE.CubeGeometry(2, 10, 2, 0, 0, 0, materials);

						var bar = new THREE.Mesh(geometry, new THREE.MeshFaceMaterial());
						bar.position.set(0,0,0);
						bar.rotation.set(0,0,0); //(0,rota,0);
						bar.updateMatrix();
						bar.translateX(2.1*i);
						billboard.add(bar);
					}
				}
				



			function init() {
				buildBillboard();
				loadTextures(searches[0].results[0], function(res) { textureBillboard(res); });
				//textureBillboard(searches[0].results[0]);
				//logMapInfo();
				//redoOffsets();
				///logMapInfo();
				
				container = document.getElementById( 'container' );
				fullWidth = container.offsetWidth;
				fullHeight = container.offsetHeight;
				halfWidth = fullWidth / 2;
				halfHeight = fullHeight / 2;

				//document.body.appendChild( container );

				scene = new THREE.Scene();

				//scene.fog = new THREE.Fog( 0xffffff, 500, 1000 );



				
				
				camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 10000);
				camera.position.z = -10;
				camera.position.y = 0;
				camera.position.x = 0;
				
				
				/*
				camera = new THREE.OrthographicCamera(
					-10,   // Left
					10,    // Right
					5,   // Top
					-5,  // Bottom
					-10,            // Near clipping plane
					10 );           // Far clipping plane
 

				camera.position.z = -5;
				camera.position.y = 0	;
				camera.position.x = 0;
				*/
				
				scene.add( camera );
					
					
				
				billboard.position.x = -(2.1*4.5);
				scene.add(billboard);
				//scene.add(mesh);


							
				scene.add(new THREE.AmbientLight(0xFFFFFF));




				// create a point light
				var pointLight = new THREE.PointLight( 0xFF0000);
				
				// set its position
				pointLight.position.x = -30;
				pointLight.position.y = -20;
				pointLight.position.z = 0;
				
				// add to the scene
				scene.add(pointLight);
    
    
				var light = new THREE.SpotLight();
				light.position.set( 17, 33, 16 );
				scene.add(light);
				
				
				
				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setSize( fullWidth, fullHeight );
				renderer.setClearColor( 0x666666, 1 );
				renderer.autoClear = false;

				renderer.domElement.style.position = "relative";
				container.appendChild( renderer.domElement );
				
				document.addEventListener( 'mousemove', onDocumentMouseMove, false );

				THREEx.WindowResize(renderer, camera, container);
				
				function redoOffsets() {
					for(var i=0; i<billboard.children.length-4; i++) {
							for (var j=0; j<4; j++) {
								var face = (j>=2) ? j+2 : j;
								
								var col = (Math.random()*16777215);
								var spec = (Math.random()*16777215);
								var amb = (Math.random()*16777215);
								
								billboard.children[i].geometry.materials[face] = new THREE.MeshPhongMaterial({ 
								ambient: amb
								, color: col
								, specular: spec
								, shininess: 50
								, shading: THREE.SmoothShading 
							});
							//	billboard.children[i].geometry.materials[face].map.offset.x = i*.1;
							//	billboard.children[i].geometry.materials[face].map.needsUpdate = true;
							}
						}
				

				};

				function logMapInfo() {
					console.log("================================");
						for(var i=0; i<billboard.children.length; i++) {
							for (var j=0; j<4; j++) {
								var face = (j>=2) ? j+2 : j;
									try {
									console.log(billboard.children[i].geometry.materials[face].map.offset.x
										+ "; needsUpdate: " + billboard.children[i].geometry.materials[face].map.needsUpdate);
									}
									catch(e) {
										console.log(e);
										console.log(billboard.children[i]);
									}
							}
						}
					console.log("+++++++++++++++++++++++++++++++++");
				}

				//logMapInfo();
				//window.setTimeout(logMapInfo, 2000);

				animate();


				function animate() {
					requestAnimationFrame( animate );
					render();
				}
	
				var lastFrameTime;
				var totalTime = 0;
				function render() {
					var now = Date.now() / 1000;
					if (!lastFrameTime) { lastFrameTime = Date.now()/1000; }
					var deltaTime = now - lastFrameTime;

					var rate = .1;
					
					var period = .25; //rotations per second
					var fullRotation = (Math.PI*2);
					var amt = (fullRotation * period * deltaTime) * rate;
					//console.log(deltaTime);
					var pause = (Math.cos((totalTime * (Math.PI/period) * period) * rate)) > 0;
					//pause = false;

					if (!pause) {
						for(var i=0; i<billboard.children.length; i++) {
							billboard.children[i].rotation.y += amt;
							
							//console.log(billboard.children[i].rotation.y);
							
							
							//(Math.PI/2)/(seconds/(period/4));
							/*
							for (var j=0; j<4; j++) {
								var face = (j>=2) ? j+2 : j;
								
								var texWidth = 1/numBars;
								var offsetX = texWidth * i;
								try {
									billboard.children[i].geometry.materials[face].map.offset.x += .001 + (i*.1); // offsetX
									billboard.children[i].geometry.materials[face].map.needsUpdate = true;
								} catch(e) {}
								//console.log(billboard.children[i].geometry.materials[face].map.offset.x
									//	+ "; needsUpdate: " + billboard.children[i].geometry.materials[face].map.needsUpdate);
							}
							*/

						

						}
    				}
					camera.lookAt( scene.position );
					renderer.render( scene, camera );
					lastFrameTime = now;
					totalTime += deltaTime;
				}


			}


			function onDocumentMouseMove(event) {

				mouseX = ( event.clientX - halfWidth );
				mouseY = ( event.clientY - halfHeight );

			}

</script>


<script type="text/javascript">

document.getElementById("fullscreen").onclick= function() {

	if( THREEx.FullScreen.activated() ){
		THREEx.FullScreen.cancel();
	}else{
		THREEx.FullScreen.request(document.getElementById( 'container' ));
	}
};
</script>
</body></html>